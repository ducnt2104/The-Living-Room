<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>B·∫£o t√†ng 3D ƒêi·ªán Bi√™n Ph·ªß</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;700&family=Be+Vietnam+Pro:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="shortcut icon" href="../../favicon.svg" type="image/x-icon" />
    <!-- Import Map cho Three.js -->
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
      }
    </script>

    <style>
      body {
        margin: 0;
        overflow: hidden;
        background-color: #f0f0f0;
        font-family: "Be Vietnam Pro", sans-serif;
      }

      /* T√¢m ng·∫Øm */
      #crosshair {
        position: fixed;
        top: 50%;
        left: 50%;
        width: 12px;
        height: 12px;
        border: 2px solid rgba(255, 255, 255, 0.8);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        z-index: 100;
        pointer-events: none;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
      }

      /* Theo d√µi nhi·ªám v·ª• */
      #quest-tracker {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid #d4af37;
        padding: 15px;
        color: #333;
        border-radius: 12px;
        z-index: 100;
        backdrop-filter: blur(10px);
        min-width: 220px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }

      /* B·∫£ng th√¥ng tin hi·ªán v·∫≠t */
      .artifact-card {
        background: #ffffff;
        border: 2px solid #d4af37;
        display: none;
        pointer-events: all;
        max-height: 90vh;
        width: 95%;
        max-width: 900px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
      }

      /* M√†n h√¨nh ch·ªù b·∫Øt ƒë·∫ßu */
      #blocker {
        position: absolute;
        width: 100%;
        height: 100%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.9) 0%,
          rgba(200, 200, 200, 1) 100%
        );
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 500;
        color: #333;
        text-align: center;
        cursor: pointer;
      }

      /* G·ª£i √Ω t∆∞∆°ng t√°c */
      .hint {
        position: fixed;
        bottom: 15%;
        left: 50%;
        transform: translateX(-50%);
        color: #d4af37;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 2px;
        text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.5);
        display: none;
        z-index: 50;
        animation: pulse 1.5s infinite;
        background: rgba(255, 255, 255, 0.8);
        padding: 8px 16px;
        border-radius: 20px;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: translateX(-50%) scale(1);
        }
        50% {
          transform: translateX(-50%) scale(1.05);
        }
      }

      /* Thanh ti·∫øn tr√¨nh */
      .progress-bar {
        width: 100%;
        height: 8px;
        background: #e0e0e0;
        border-radius: 4px;
        margin-top: 10px;
        overflow: hidden;
      }
      #progress-fill {
        width: 0%;
        height: 100%;
        background: linear-gradient(90deg, #d4af37, #f1c40f);
        transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Video Overlay (√âp xem) */
      #video-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: black;
        z-index: 2000;
      }

      /* Thanh cu·ªôn n·ªôi dung */
      #artifact-content::-webkit-scrollbar {
        width: 6px;
      }
      #artifact-content::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      #artifact-content::-webkit-scrollbar-thumb {
        background: #d4af37;
        border-radius: 10px;
      }

      /* M√†n h√¨nh k·∫øt th√∫c */
      #end-screen {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(10px);
        z-index: 3000;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <!-- M√†n h√¨nh ch√†o m·ª´ng -->
    <div id="blocker">
      <div
        class="max-w-2xl p-10 bg-white border border-yellow-600/30 rounded-3xl shadow-2xl"
      >
        <h1
          class="text-5xl md:text-6xl font-bold mb-4 text-yellow-600 font-serif uppercase tracking-tight"
        >
          B·∫£o t√†ng ƒêi·ªán Bi√™n Ph·ªß
        </h1>
        <p class="text-lg text-gray-600 mb-8 font-light italic">
          "Ch·∫•n ƒë·ªông ƒë·ªãa c·∫ßu - B·∫£n h√πng ca c·ªßa l√≤ng y√™u n∆∞·ªõc"
        </p>
        <div
          class="space-y-3 text-left text-sm text-gray-700 mb-8 bg-gray-50 p-6 rounded-xl border border-gray-200"
        >
          <p class="flex items-center gap-2">
            üïπÔ∏è S·ª≠ d·ª•ng ph√≠m <b>W, A, S, D</b> ƒë·ªÉ di chuy·ªÉn.
          </p>
          <p class="flex items-center gap-2">
            üñ±Ô∏è Di chuy·ªÉn <b>Chu·ªôt</b> ƒë·ªÉ nh√¨n xung quanh.
          </p>
          <p class="flex items-center gap-2">
            üëÜ H∆∞·ªõng t√¢m ng·∫Øm v√† click <b>Chu·ªôt tr√°i</b> v√†o c√°c m√¥ h√¨nh ƒë·ªÉ xem
            th√¥ng tin.
          </p>
          <p class="flex items-center gap-2 text-red-600 font-semibold mt-2">
            ‚≠ê Ho√†n th√†nh kh√°m ph√° 5 m√¥ h√¨nh ƒë·ªÉ m·ªü kh√≥a phim t√†i li·ªáu.
          </p>
        </div>
        <button
          id="start-btn"
          class="w-full bg-yellow-600 hover:bg-yellow-500 text-white px-10 py-4 rounded-xl font-bold transition-all uppercase tracking-widest shadow-lg"
        >
          B·∫Øt ƒë·∫ßu tham quan
        </button>
      </div>
    </div>

    <!-- UI Nhi·ªám v·ª• -->
    <div id="quest-tracker">
      <h4
        class="text-[11px] uppercase tracking-[0.1em] text-yellow-600 font-bold mb-1"
      >
        Ti·∫øn tr√¨nh tham quan
      </h4>
      <div class="text-3xl font-bold font-serif text-gray-800">
        <span id="quest-count">0</span> / 5
      </div>
      <div class="progress-bar"><div id="progress-fill"></div></div>
      <p
        id="quest-msg"
        class="text-[10px] text-gray-500 mt-2 uppercase tracking-wide font-semibold"
      >
        Kh√°m ph√° c√°c m√¥ h√¨nh...
      </p>
    </div>

    <div id="crosshair"></div>
    <div id="hint" class="hint">Nh·∫•p chu·ªôt tr√°i ƒë·ªÉ xem</div>

    <!-- B·∫£ng th√¥ng tin hi·ªán v·∫≠t -->
    <!-- N√öT THO√ÅT (·∫®n m·∫∑c ƒë·ªãnh) -->
    <button
      id="exit-artifact-btn"
      style="
        display: none;
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 9999;
        padding: 12px 24px;
        font-size: 18px;
        background: #ff4a4a;
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      "
    >
      Tho√°t hi·ªán v·∫≠t
    </button>

    <!-- B·∫¢NG ƒêI·ªÄU KHI·ªÇN MOBILE (·∫®n m·∫∑c ƒë·ªãnh) -->
    <div
      id="mobile-joystick"
      style="
        display: none;
        position: absolute;
        bottom: 30px;
        left: 30px;
        z-index: 9999;
        pointer-events: auto;
      "
    >
      <div style="display: flex; flex-direction: column; align-items: center">
        <button
          id="btn-up"
          style="
            width: 60px;
            height: 60px;
            margin: 5px;
            border-radius: 30px;
            font-size: 24px;
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid #333;
            cursor: pointer;
            user-select: none;
          "
        >
          ‚ñ≤
        </button>
        <div style="display: flex">
          <button
            id="btn-left"
            style="
              width: 60px;
              height: 60px;
              margin: 5px;
              border-radius: 30px;
              font-size: 24px;
              background: rgba(255, 255, 255, 0.7);
              border: 2px solid #333;
              cursor: pointer;
              user-select: none;
            "
          >
            ‚óÄ
          </button>
          <button
            id="btn-down"
            style="
              width: 60px;
              height: 60px;
              margin: 5px;
              border-radius: 30px;
              font-size: 24px;
              background: rgba(255, 255, 255, 0.7);
              border: 2px solid #333;
              cursor: pointer;
              user-select: none;
            "
          >
            ‚ñº
          </button>
          <button
            id="btn-right"
            style="
              width: 60px;
              height: 60px;
              margin: 5px;
              border-radius: 30px;
              font-size: 24px;
              background: rgba(255, 255, 255, 0.7);
              border: 2px solid #333;
              cursor: pointer;
              user-select: none;
            "
          >
            ‚ñ∂
          </button>
        </div>
      </div>
    </div>
    <div
      id="info-panel"
      class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[600] artifact-card rounded-3xl overflow-hidden"
    >
      <div class="p-8 md:p-12">
        <div class="flex items-center gap-4 mb-3">
          <span class="h-px w-12 bg-yellow-600"></span>
          <span
            class="text-yellow-600 text-sm font-bold uppercase tracking-[0.2em]"
            >H·ªì s∆° di t√≠ch</span
          >
        </div>
        <h2
          id="artifact-name"
          class="text-3xl md:text-5xl font-bold text-gray-900 mb-6 font-serif uppercase"
        ></h2>

        <div
          id="artifact-content"
          class="text-gray-700 leading-relaxed text-lg h-[35vh] overflow-y-auto pr-6 mb-8 border-l-4 border-yellow-500 pl-6 bg-gray-50 p-4 rounded-r-xl shadow-inner"
        >
          <!-- Content injected here -->
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
          <div class="bg-blue-50 p-5 rounded-2xl border border-blue-100">
            <h4
              class="text-blue-800 font-bold text-sm uppercase mb-2 tracking-wide"
            >
              Chi·∫øn thu·∫≠t & Di·ªÖn bi·∫øn
            </h4>
            <p
              id="artifact-tactic"
              class="text-gray-700 text-sm leading-relaxed"
            ></p>
          </div>
          <div class="bg-red-50 p-5 rounded-2xl border border-red-100">
            <h4
              class="text-red-800 font-bold text-sm uppercase mb-2 tracking-wide"
            >
              D·∫•u ·∫•n l·ªãch s·ª≠
            </h4>
            <p
              id="artifact-history"
              class="text-gray-700 text-sm leading-relaxed"
            ></p>
          </div>
        </div>

        <div class="flex justify-end">
          <button
            onclick="closePanel()"
            class="bg-yellow-600 hover:bg-yellow-700 text-white px-10 py-3 rounded-xl font-bold transition-all uppercase text-sm tracking-widest shadow-md"
          >
            ƒê√≥ng & Ti·∫øp t·ª•c
          </button>
        </div>
      </div>
    </div>

    <!-- Tr√¨nh chi·∫øu Video -->
    <div id="video-overlay">
      <!-- Kh√¥ng c√≥ n√∫t ƒë√≥ng, √©p xem h·∫øt -->
      <video id="full-video" class="w-full h-full object-contain bg-black">
        <source src="dien-bien.mp4" type="video/mp4" />
        Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ th·∫ª video.
      </video>
    </div>

    <!-- M√†n h√¨nh k·∫øt th√∫c (Hi·ªán sau khi xem xong video) -->
    <div id="end-screen">
      <div
        class="bg-white p-10 rounded-3xl text-center max-w-2xl w-11/12 shadow-[0_0_50px_rgba(255,255,255,0.2)]"
      >
        <h2 class="text-4xl font-serif font-bold text-yellow-600 mb-4">
          Ho√†n th√†nh kh√≥a h·ªçc!
        </h2>
        <p class="text-gray-600 mb-10 text-lg">
          B·∫°n ƒë√£ xu·∫•t s·∫Øc ho√†n th√†nh vi·ªác t√¨m hi·ªÉu to√†n b·ªô di t√≠ch v√† theo d√µi
          th∆∞·ªõc phim l·ªãch s·ª≠ h√†o h√πng c·ªßa chi·∫øn th·∫Øng ƒêi·ªán Bi√™n Ph·ªß.
        </p>

        <div class="flex flex-col md:flex-row gap-4 justify-center">
          <a
            href="bai_tap_dien_bien.html"
            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-4 rounded-xl font-bold transition-transform hover:scale-105 shadow-lg flex-1"
          >
            üìù L√†m b√†i t·∫≠p
          </a>
          <a
            href="nhan_vat_dien_bien.html"
            class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-4 rounded-xl font-bold transition-transform hover:scale-105 shadow-lg flex-1"
          >
            üí¨ Tr√≤ chuy·ªán nh√¢n v·∫≠t
          </a>
          <a
            href="../../index.html"
            class="bg-gray-800 hover:bg-gray-900 text-white px-6 py-4 rounded-xl font-bold transition-transform hover:scale-105 shadow-lg flex-1"
          >
            üè† V·ªÅ trang ch·ªß
          </a>
        </div>
      </div>
    </div>

    <script type="module">
      import * as THREE from "three";
      import { PointerLockControls } from "three/addons/controls/PointerLockControls.js";

      // ==========================================
      // N·ªòI DUNG HI·ªÜN V·∫¨T
      // ==========================================
      const artifactsData = {
        a1_hill: {
          name: "ƒê·ªìi A1 & H·ªë B·ªôc Ph√°",
          content: `ƒê·ªìi A1 l√† c·ª© ƒëi·ªÉm quan tr·ªçng nh·∫•t trong d√£y ƒë·ªìi ph√≠a ƒê√¥ng. T·∫°i ƒë√¢y ta v√† Ph√°p gi√†nh nhau t·ª´ng t·∫•c ƒë·∫•t, ƒë√°nh ƒëi ƒë√°nh l·∫°i t·ªõi 4 ƒë·ª£t nh∆∞ng v·∫´n ch∆∞a d·ª©t ƒëi·ªÉm ƒë∆∞·ª£c v√¨ h·ªá th·ªëng h·∫ßm ng·∫ßm c·ªßa Ph√°p qu√° ki√™n c·ªë.<br><br><b>ƒê√™m 06/05 (ƒê·ª£t 3)</b>: Sau khi ƒë√†o m·ªôt ƒë∆∞·ªùng h·∫ßm s√¢u v√†o l√≤ng ƒë·ªìi, qu√¢n ta ƒë·∫∑t kh·ªëi b·ªôc ph√° kh·ªïng l·ªì n·∫∑ng 960kg. Ti·∫øng n·ªï l·ªõn l√∫c 20h30 l√† hi·ªáu l·ªánh t·ªïng t·∫•n c√¥ng tr√™n to√†n m·∫∑t tr·∫≠n.`,
          tactic:
            "ƒê√†o h·∫ßm ng·∫ßm d∆∞·ªõi l√≤ng ƒë·∫•t, d√πng b·ªôc ph√° kh·ªëi l∆∞·ª£ng l·ªõn ph√° v·ª° h·ªá th·ªëng h·∫ßm ng·∫ßm ki√™n c·ªë ƒë·ªãch.",
          history:
            "ƒêi·ªÉm n√≥ng quy·∫øt ƒë·ªãnh c·ª•c di·ªán chi·∫øn d·ªãch. Ch√¨a kh√≥a m·ªü toang t·∫≠p ƒëo√†n c·ª© ƒëi·ªÉm.",
        },
        de_castries: {
          name: "H·∫ßm T∆∞·ªõng De Castries",
          content: `C∆° quan ƒë·∫ßu n√£o c·ªßa th·ª±c d√¢n Ph√°p, c√≥ c·∫•u tr√∫c m√°i v√≤m s·∫Øt u·ªën cong c·ª±c k·ª≥ v·ªØng ch√£i, n·∫±m t·∫°i trung t√¢m M∆∞·ªùng Thanh.<br><br><b>Chi·ªÅu 07/05/1954:</b> 15h00, qu√¢n ta t·ªïng l·ª±c t·∫•n c√¥ng v√†o trung t√¢m t·ª´ nhi·ªÅu h∆∞·ªõng. 17h30, t·ªï xung k√≠ch do ƒë·ªìng ch√≠ T·∫° Qu·ªëc Lu·∫≠t ch·ªâ huy ·∫≠p v√†o h·∫ßm ng·∫ßm, b·∫Øt s·ªëng t∆∞·ªõng De Castries v√† to√†n b·ªô ban tham m∆∞u c·ªßa Ph√°p.`,
          tactic:
            "√Åp d·ª•ng chi·∫øn thu·∫≠t 'V√¢y l·∫•n', si·∫øt ch·∫∑t v√≤ng v√¢y, ti√™u di·ªát c∆° quan ƒë·∫ßu n√£o.",
          history:
            "N∆°i ch·ª©ng ki·∫øn s·ª± ƒë·∫ßu h√†ng v√¥ ƒëi·ªÅu ki·ªán, k·∫øt th√∫c 56 ng√†y ƒë√™m l·ªãch s·ª≠.",
        },
        muong_phang: {
          name: "S·ªü ch·ªâ huy M∆∞·ªùng PhƒÉng",
          content: `N·∫±m ·∫©n m√¨nh d∆∞·ªõi t√°n r·ª´ng ƒë·∫°i ng√†n, c√°ch trung t√¢m M∆∞·ªùng Thanh kho·∫£ng 25km. N∆°i ƒë√¢y c√≥ l√°n ·ªü v√† ƒë∆∞·ªùng h·∫ßm xuy√™n n√∫i th√¥ s∆° nh∆∞ng c·ª±c k·ª≥ b√≠ m·∫≠t.<br><br>ƒê√¢y l√† n∆°i ƒê·∫°i t∆∞·ªõng V√µ Nguy√™n Gi√°p l√†m vi·ªác v√† ƒë∆∞a ra quy·∫øt ƒë·ªãnh l·ªãch s·ª≠ kh√≥ khƒÉn nh·∫•t trong ƒë·ªùi binh nghi·ªáp: Chuy·ªÉn ph∆∞∆°ng ch√¢m t·ª´ <b>"ƒê√°nh nhanh th·∫Øng nhanh"</b> sang <b>"ƒê√°nh ch·∫Øc ti·∫øn ch·∫Øc"</b>.`,
          tactic:
            "V·ªã tr√≠ ch·ªâ huy an to√†n, b√≠ m·∫≠t, bao qu√°t chi·∫øn tr∆∞·ªùng ƒë·ªÉ ƒë∆∞a ra quy·∫øt ƒë·ªãnh s√°t th·ª±c t·∫ø.",
          history: "Linh h·ªìn chi·∫øn l∆∞·ª£c c·ªßa to√†n b·ªô chi·∫øn d·ªãch ƒêi·ªán Bi√™n Ph·ªß.",
        },
        panorama: {
          name: "B·∫£o t√†ng & Tranh Panorama",
          content: `B·∫£o t√†ng Chi·∫øn th·∫Øng l·ªãch s·ª≠ ƒêi·ªán Bi√™n Ph·ªß. ƒêi·ªÉm nh·∫•n l√† b·ª©c tranh Panorama (tranh to√†n c·∫£nh) l·ªõn nh·∫•t th·∫ø gi·ªõi v·ªÅ chi·∫øn d·ªãch n√†y.<br><br>B·ª©c tranh t√°i hi·ªán c·ª±c k·ª≥ ch√¢n th·ª±c 56 ng√†y ƒë√™m kh√≥i l·ª≠a, t·ª´ nh·ªØng tr·∫≠n m·ªü m√†n (ƒë·ªôt ph√° c·ª≠a ng√µ) ƒë√°nh v√†o Him Lam, ƒê·ªôc L·∫≠p cho ƒë·∫øn ng√†y chi·∫øn th·∫Øng huy ho√†ng.`,
          tactic:
            "Ghi ch√©p v√† l∆∞u gi·ªØ to√†n b·ªô kh√¥ng gian, th·ªùi gian c·ªßa chi·∫øn d·ªãch m·ªôt c√°ch tr·ª±c quan.",
          history:
            "C√¥ng tr√¨nh ngh·ªá thu·∫≠t mang t·∫ßm v√≥c qu·ªëc t·∫ø, b·∫£o t·ªìn vƒ©nh vi·ªÖn k√Ω ·ª©c h√†o h√πng.",
        },
        cemetery: {
          name: "Nghƒ©a trang Li·ªát sƒ© A1",
          content: `N∆°i an ngh·ªâ v√† tri √¢n nh·ªØng ng∆∞·ªùi h√πng ƒë√£ n·∫±m l·∫°i m·∫£nh ƒë·∫•t n√†y. H·ªç ƒë√£ chi·∫øn ƒë·∫•u anh d≈©ng qua 3 ƒë·ª£t t·∫•n c√¥ng cam go.<br><br>Ti√™u bi·ªÉu nh∆∞ anh h√πng Phan ƒê√¨nh Gi√≥t l·∫•y th√¢n m√¨nh l·∫•p l·ªó ch√¢u mai trong tr·∫≠n m·ªü m√†n Him Lam (13/03), hay anh h√πng T√¥ Vƒ©nh Di·ªán l·∫•y th√¢n ch√®n ph√°o.`,
          tactic:
            "Tinh th·∫ßn 'Quy·∫øt t·ª≠ cho T·ªï qu·ªëc quy·∫øt sinh', s·∫µn s√†ng hy sinh v√¨ m·ª•c ti√™u chung.",
          history:
            "Bi·ªÉu t∆∞·ª£ng b·∫•t di·ªát c·ªßa l√≤ng bi·∫øt ∆°n v√† s·ª± hy sinh v√¨ ƒë·ªôc l·∫≠p, t·ª± do c·ªßa d√¢n t·ªôc.",
        },
      };

      // ==========================================
      // KHAI B√ÅO BI·∫æN THREE.JS
      // ==========================================
      let scene, camera, renderer, controls;
      let moveForward = false,
        moveBackward = false,
        moveLeft = false,
        moveRight = false;
      let velocity = new THREE.Vector3();
      let direction = new THREE.Vector3();

      let hitBoxes = []; // Ch·ª©a c√°c kh·ªëi t√†ng h√¨nh ƒë·ªÉ click chu·ªôt
      let animatedModels = []; // Ch·ª©a c√°c model c·∫ßn xoay animation
      let visited = new Set();
      let prevTime = performance.now();

      init();
      animate();

      function init() {
        // 1. SCENE
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf5f5f5); // M√†u ph√≤ng s√°ng
        scene.fog = new THREE.Fog(0xf5f5f5, 10, 80);

        // 2. CAMERA
        camera = new THREE.PerspectiveCamera(
          70,
          window.innerWidth / window.innerHeight,
          0.1,
          1000,
        );
        camera.position.set(0, 1.7, 10); // Chi·ªÅu cao m·∫Øt ng∆∞·ªùi

        // 3. LIGHTING (S√°ng s·ªßa h∆°n)
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);

        const hemiLight = new THREE.HemisphereLight(0xffffff, 0xdddddd, 0.6);
        hemiLight.position.set(0, 20, 0);
        scene.add(hemiLight);

        // 4. CONTROLS
        controls = new PointerLockControls(camera, document.body);
        const blocker = document.getElementById("blocker");
        const startBtn = document.getElementById("start-btn");

        startBtn.addEventListener("click", () => {
          controls.lock();
        });

        controls.addEventListener("lock", () => {
          blocker.style.display = "none";
        });

        controls.addEventListener("unlock", () => {
          if (
            document.getElementById("info-panel").style.display !== "block" &&
            document.getElementById("video-overlay").style.display !==
              "block" &&
            document.getElementById("end-screen").style.display !== "flex"
          ) {
            blocker.style.display = "flex";
            document.getElementById("start-btn").innerText =
              "Ti·∫øp t·ª•c tham quan";
          }
        });

        // 5. X√ÇY D·ª∞NG KH√îNG GIAN B·∫¢O T√ÄNG (Ph√≤ng tr∆∞ng b√†y)
        buildMuseumRoom();

        // 6. T·∫†O V√Ä ƒê·∫∂T 5 M√î H√åNH V√ÄO B·ª§C
        // Tham s·ªë: x, z, id, h√†m t·∫°o model
        placeArtifact(-15, -10, "a1_hill", createA1Hill);
        placeArtifact(-5, -20, "de_castries", createDeCastries);
        placeArtifact(5, -20, "muong_phang", createMuongPhang);
        placeArtifact(15, -10, "panorama", createPanorama);
        placeArtifact(0, -5, "cemetery", createCemetery); // ·ªû gi·ªØa g·∫ßn c·ª≠a

        // 7. RENDERER
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);

        // 8. EVENTS
        window.addEventListener("resize", onWindowResize);
        document.addEventListener("keydown", onKeyDown);
        document.addEventListener("keyup", onKeyUp);
        document.addEventListener("mousedown", onMouseDown);
      }

      // --- C√ÅC H√ÄM X√ÇY D·ª∞NG M√î H√åNH 3D ---

      function buildMuseumRoom() {
        // S√†n nh√† (G·ªó nh·∫°t)
        const floorGeo = new THREE.PlaneGeometry(100, 100);
        const floorMat = new THREE.MeshStandardMaterial({
          color: 0xe8dcc5,
          roughness: 0.8,
        });
        const floor = new THREE.Mesh(floorGeo, floorMat);
        floor.rotation.x = -Math.PI / 2;
        floor.receiveShadow = true;
        scene.add(floor);

        // T∆∞·ªùng ph√≤ng (M√†u tr·∫Øng kem)
        const wallMat = new THREE.MeshStandardMaterial({
          color: 0xffffff,
          roughness: 1,
        });

        // T∆∞·ªùng sau
        const backWall = new THREE.Mesh(
          new THREE.BoxGeometry(60, 20, 1),
          wallMat,
        );
        backWall.position.set(0, 10, -30);
        scene.add(backWall);

        // T∆∞·ªùng tr√°i
        const leftWall = new THREE.Mesh(
          new THREE.BoxGeometry(1, 20, 60),
          wallMat,
        );
        leftWall.position.set(-30, 10, 0);
        scene.add(leftWall);

        // T∆∞·ªùng ph·∫£i
        const rightWall = new THREE.Mesh(
          new THREE.BoxGeometry(1, 20, 60),
          wallMat,
        );
        rightWall.position.set(30, 10, 0);
        scene.add(rightWall);

        // T∆∞·ªùng tr∆∞·ªõc
        const frontWall = new THREE.Mesh(
          new THREE.BoxGeometry(60, 20, 1),
          wallMat,
        );
        frontWall.position.set(0, 10, 30);
        scene.add(frontWall);

        // Tr·∫ßn nh√†
        const ceilGeo = new THREE.PlaneGeometry(60, 60);
        const ceilMat = new THREE.MeshStandardMaterial({ color: 0xdddddd });
        const ceiling = new THREE.Mesh(ceilGeo, ceilMat);
        ceiling.rotation.x = Math.PI / 2;
        ceiling.position.y = 20;
        scene.add(ceiling);
      }

      function placeArtifact(x, z, id, modelCreationFunc) {
        const group = new THREE.Group();
        group.position.set(x, 0, z);

        // 1. T·∫°o b·ª•c tr∆∞ng b√†y
        const pedestalGeo = new THREE.CylinderGeometry(1.5, 1.8, 1.2, 32);
        const pedestalMat = new THREE.MeshStandardMaterial({
          color: 0xffffff,
          roughness: 0.2,
        });
        const pedestal = new THREE.Mesh(pedestalGeo, pedestalMat);
        pedestal.position.y = 0.6;
        pedestal.receiveShadow = true;
        pedestal.castShadow = true;
        group.add(pedestal);

        // ƒê·∫ø trang tr√≠ cho b·ª•c
        const baseGeo = new THREE.CylinderGeometry(2, 2, 0.1, 32);
        const baseMat = new THREE.MeshStandardMaterial({ color: 0xd4af37 }); // Vi·ªÅn v√†ng
        const base = new THREE.Mesh(baseGeo, baseMat);
        base.position.y = 0.05;
        group.add(base);

        // 2. T·∫°o Model 3D t·ª´ h√†m
        const modelGroup = modelCreationFunc();
        // Scale nh·ªè l·∫°i ƒë·ªÉ v·ª´a b·ª•c
        modelGroup.scale.set(0.25, 0.25, 0.25);
        modelGroup.position.y = 1.3; // ƒê·∫∑t l√™n b·ª•c
        group.add(modelGroup);
        animatedModels.push(modelGroup); // L∆∞u ƒë·ªÉ xoay

        // 3. ƒê√®n Spotlight chi·∫øu ri√™ng cho hi·ªán v·∫≠t
        const spotLight = new THREE.SpotLight(
          0xffffff,
          1.5,
          20,
          Math.PI / 6,
          0.5,
          1,
        );
        spotLight.position.set(x, 8, z);
        spotLight.target = pedestal;
        scene.add(spotLight);

        // 4. Hitbox t√†ng h√¨nh ƒë·ªÉ d·ªÖ click chu·ªôt (B·ªçc to√†n b·ªô khu v·ª±c b·ª•c)
        const hitBoxGeo = new THREE.BoxGeometry(3, 4, 3);
        const hitBoxMat = new THREE.MeshBasicMaterial({ visible: false }); // T√†ng h√¨nh
        const hitBox = new THREE.Mesh(hitBoxGeo, hitBoxMat);
        hitBox.position.y = 2;
        hitBox.userData = { id: id, baseMat: baseMat }; // L∆∞u th√¥ng tin
        group.add(hitBox);
        hitBoxes.push(hitBox);

        scene.add(group);
      }

      // --- C√ÅC H√ÄM T·∫†O 5 M√î H√åNH CHI TI·∫æT ---

      function createA1Hill() {
        const group = new THREE.Group();
        // ƒê·ªìi
        const hill = new THREE.Mesh(
          new THREE.ConeGeometry(4, 5, 32),
          new THREE.MeshStandardMaterial({ color: 0x4a5d23, roughness: 0.8 }),
        );
        hill.position.y = 2.5;
        group.add(hill);
        // H·ªë b·ªôc ph√°
        const crater = new THREE.Mesh(
          new THREE.SphereGeometry(1.5, 32, 16, 0, Math.PI * 2, 0, Math.PI / 2),
          new THREE.MeshStandardMaterial({
            color: 0x2b1d14,
            side: THREE.DoubleSide,
          }),
        );
        crater.rotation.x = Math.PI;
        crater.position.set(1.5, 4.5, 0);
        group.add(crater);
        return group;
      }

      function createDeCastries() {
        const group = new THREE.Group();
        const mat = new THREE.MeshStandardMaterial({
          color: 0x3d4045,
          metalness: 0.6,
        });
        // ƒê·∫ø
        const base = new THREE.Mesh(new THREE.BoxGeometry(6, 1.5, 4), mat);
        base.position.y = 0.75;
        group.add(base);
        // M√°i v√≤m
        const roof = new THREE.Mesh(
          new THREE.CylinderGeometry(2, 2, 6, 32, 1, false, 0, Math.PI),
          mat,
        );
        roof.rotation.z = Math.PI / 2;
        roof.position.y = 1.5;
        group.add(roof);
        return group;
      }

      function createMuongPhang() {
        const group = new THREE.Group();
        // L√°n
        const hut = new THREE.Mesh(
          new THREE.BoxGeometry(3, 2.5, 2.5),
          new THREE.MeshStandardMaterial({ color: 0x5c4033 }),
        );
        hut.position.y = 1.25;
        group.add(hut);
        // M√°i
        const roof = new THREE.Mesh(
          new THREE.ConeGeometry(2.5, 1.5, 4),
          new THREE.MeshStandardMaterial({ color: 0x8b7355 }),
        );
        roof.rotation.y = Math.PI / 4;
        roof.position.y = 3.25;
        group.add(roof);
        // H·∫ßm
        const tunnel = new THREE.Mesh(
          new THREE.CylinderGeometry(0.6, 0.6, 3, 16),
          new THREE.MeshStandardMaterial({ color: 0x222222 }),
        );
        tunnel.rotation.x = Math.PI / 2;
        tunnel.position.set(0, 0.6, 2.5);
        group.add(tunnel);
        return group;
      }

      function createPanorama() {
        const group = new THREE.Group();
        const museum = new THREE.Mesh(
          new THREE.CylinderGeometry(3.5, 3.5, 3.5, 32),
          new THREE.MeshStandardMaterial({ color: 0x8b3a3a }),
        );
        museum.position.y = 1.75;
        group.add(museum);
        const dome = new THREE.Mesh(
          new THREE.CylinderGeometry(3.2, 3.2, 0.5, 32),
          new THREE.MeshStandardMaterial({ color: 0xdddddd }),
        );
        dome.position.y = 3.75;
        group.add(dome);
        return group;
      }

      function createCemetery() {
        const group = new THREE.Group();
        const base = new THREE.Mesh(
          new THREE.BoxGeometry(6, 0.2, 6),
          new THREE.MeshStandardMaterial({ color: 0x6e6e6e }),
        );
        base.position.y = 0.1;
        group.add(base);

        const graveMat = new THREE.MeshStandardMaterial({ color: 0xeeeeee });
        const graveGeo = new THREE.BoxGeometry(0.5, 0.8, 0.2);
        for (let i = -1; i <= 1; i++) {
          for (let j = -1.5; j <= 1.5; j += 1) {
            const grave = new THREE.Mesh(graveGeo, graveMat);
            grave.position.set(i * 1.5, 0.5, j * 1.2);
            group.add(grave);
          }
        }
        const mainMon = new THREE.Mesh(
          new THREE.BoxGeometry(1.2, 2.5, 0.5),
          graveMat,
        );
        mainMon.position.set(0, 1.25, -2.5);
        group.add(mainMon);
        return group;
      }

      // --- LOGIC DI CHUY·ªÇN & T∆Ø∆†NG T√ÅC ---

      function onKeyDown(e) {
        if (!controls.isLocked) return;
        switch (e.code) {
          case "KeyW":
            moveForward = true;
            break;
          case "KeyA":
            moveLeft = true;
            break;
          case "KeyS":
            moveBackward = true;
            break;
          case "KeyD":
            moveRight = true;
            break;
        }
      }

      function onKeyUp(e) {
        switch (e.code) {
          case "KeyW":
            moveForward = false;
            break;
          case "KeyA":
            moveLeft = false;
            break;
          case "KeyS":
            moveBackward = false;
            break;
          case "KeyD":
            moveRight = false;
            break;
        }
      }

      function onMouseDown() {
        if (!controls.isLocked) return;
        const raycaster = new THREE.Raycaster();
        raycaster.setFromCamera(new THREE.Vector2(), camera);

        // B·∫Øn tia ray v√†o c√°c hitbox t√†ng h√¨nh
        const intersects = raycaster.intersectObjects(hitBoxes);
        if (intersects.length > 0) {
          const hitData = intersects[0].object.userData;
          const id = hitData.id;

          visited.add(id);

          // ƒê·ªïi m√†u vi·ªÅn b·ª•c th√†nh xanh l√° ƒë·ªÉ ƒë√°nh d·∫•u ƒë√£ xem
          hitData.baseMat.color.setHex(0x4ade80);

          updateUI();
          openPanel(id);
        }
      }

      function updateUI() {
        const count = visited.size;
        document.getElementById("quest-count").innerText = count;
        document.getElementById("progress-fill").style.width =
          (count / 5) * 100 + "%";

        if (count === 5) {
          setTimeout(() => {
            const videoOverlay = document.getElementById("video-overlay");
            const videoEl = document.getElementById("full-video");

            videoOverlay.style.display = "block";
            videoEl.muted = false;
            videoEl.play();

            videoEl.onended = () => {
              videoOverlay.style.display = "none";
              document.getElementById("end-screen").style.display = "flex";
            };
          }, 800);
        }
      }

      function openPanel(id) {
        const data = artifactsData[id];
        document.getElementById("artifact-name").innerText = data.name;
        document.getElementById("artifact-content").innerHTML = data.content;
        document.getElementById("artifact-tactic").innerText = data.tactic;
        document.getElementById("artifact-history").innerText = data.history;

        controls.unlock();
        document.getElementById("info-panel").style.display = "block";
      }

      // H√†m ƒë√≥ng Panel (Ph∆°i ra d·∫°ng global ƒë·ªÉ HTML g·ªçi)
      window.closePanel = function () {
        document.getElementById("info-panel").style.display = "none";

        if (visited.size === 5) {
          // B·∫≠t video v√† √©p xem
          const videoOverlay = document.getElementById("video-overlay");
          const videoEl = document.getElementById("full-video");

          videoOverlay.style.display = "block";
          videoEl.play().catch((e) => console.log("L·ªói autoplay video:", e));

          // S·ª± ki·ªán b·∫Øt bu·ªôc khi video k·∫øt th√∫c
          videoEl.onended = () => {
            videoOverlay.style.display = "none";
            document.getElementById("end-screen").style.display = "flex";
          };
        } else {
          controls.lock(); // M·ªü kh√≥a chu·ªôt ƒë·ªÉ ƒëi ti·∫øp
        }
      };

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      function animate() {
        requestAnimationFrame(animate);
        const time = performance.now();

        if (controls.isLocked) {
          const delta = (time - prevTime) / 1000;

          // X·ª≠ l√Ω ma s√°t v√† gia t·ªëc
          velocity.x -= velocity.x * 10.0 * delta;
          velocity.z -= velocity.z * 10.0 * delta;

          direction.z = Number(moveForward) - Number(moveBackward);
          direction.x = Number(moveRight) - Number(moveLeft);
          direction.normalize();

          if (moveForward || moveBackward)
            velocity.z -= direction.z * 60.0 * delta; // T·ªëc ƒë·ªô ƒëi b·ªô
          if (moveLeft || moveRight) velocity.x -= direction.x * 60.0 * delta;

          controls.moveRight(-velocity.x * delta);
          controls.moveForward(-velocity.z * delta);

          // Ph√°t hi·ªán xem c√≥ ƒëang nh√¨n v√†o hitbox n√†o kh√¥ng ƒë·ªÉ hi·ªán Hint
          const raycaster = new THREE.Raycaster();
          raycaster.setFromCamera(new THREE.Vector2(), camera);
          const intersects = raycaster.intersectObjects(hitBoxes);
          document.getElementById("hint").style.display =
            intersects.length > 0 ? "block" : "none";
        }

        // Xoay nh·∫π c√°c m√¥ h√¨nh 3D tr√™n b·ª•c
        animatedModels.forEach((model) => {
          model.rotation.y += 0.005;
        });

        prevTime = time;
        renderer.render(scene, camera);
      }
      // ... existing code ...
      // --- B·∫ÆT ƒê·∫¶U: LOGIC N√öT THO√ÅT V√Ä MOBILE ---
      const exitArtifactBtn = document.getElementById("exit-artifact-btn");
      const mobileJoystick = document.getElementById("mobile-joystick");

      // 1. H√†m hi·ªÉn th·ªã n√∫t tho√°t (B·∫°n c·∫ßn g·ªçi h√†m window.showExitButton() khi ng∆∞·ªùi ch∆°i click v√†o hi·ªán v·∫≠t)
      window.showExitButton = function () {
        exitArtifactBtn.style.display = "block";
      };

      // 2. X·ª≠ l√Ω s·ª± ki·ªán khi b·∫•m n√∫t Tho√°t
      exitArtifactBtn.addEventListener("click", () => {
        exitArtifactBtn.style.display = "none";
        // T·∫†I ƒê√ÇY: Th√™m logic ƒë·ªÉ ·∫©n giao di·ªán xem hi·ªán v·∫≠t, m·ªü kh√≥a l·∫°i camera di chuy·ªÉn
        console.log("ƒê√£ tho√°t ch·∫ø ƒë·ªô kh√°m ph√° hi·ªán v·∫≠t");
      });

      // 3. Ki·ªÉm tra thi·∫øt b·ªã Mobile v√† b·∫≠t ƒëi·ªÅu khi·ªÉn c·∫£m ·ª©ng
      const isTouchDevice =
        "ontouchstart" in window || navigator.maxTouchPoints > 0;
      if (isTouchDevice) {
        mobileJoystick.style.display = "block";

        // G·∫Øn s·ª± ki·ªán touch cho di chuy·ªÉn (Li√™n k·∫øt v·ªõi c√°c bi·∫øn di chuy·ªÉn c·ªßa b·∫°n)
        const setupTouch = (id, action) => {
          const btn = document.getElementById(id);
          btn.addEventListener("touchstart", (e) => {
            e.preventDefault();
            // T·∫†I ƒê√ÇY: B·∫≠t bi·∫øn di chuy·ªÉn (V√≠ d·ª•: keys[action] = true;)
          });
          btn.addEventListener("touchend", (e) => {
            e.preventDefault();
            // T·∫†I ƒê√ÇY: T·∫Øt bi·∫øn di chuy·ªÉn (V√≠ d·ª•: keys[action] = false;)
          });
        };

        setupTouch("btn-up", "forward");
        setupTouch("btn-down", "backward");
        setupTouch("btn-left", "left");
        setupTouch("btn-right", "right");

        // 4. Vu·ªët m√†n h√¨nh ƒë·ªÉ xoay Camera
        let touchStartX = 0,
          touchStartY = 0;
        document.addEventListener(
          "touchstart",
          (e) => {
            if (e.target.tagName !== "BUTTON") {
              // Kh√¥ng xoay camera n·∫øu ƒëang b·∫•m n√∫t di chuy·ªÉn
              touchStartX = e.touches[0].clientX;
              touchStartY = e.touches[0].clientY;
            }
          },
          { passive: false },
        );

        document.addEventListener(
          "touchmove",
          (e) => {
            if (e.target.tagName !== "BUTTON" && e.touches.length === 1) {
              e.preventDefault(); // Tr√°nh b·ªã cu·ªôn trang khi ƒëang ch∆°i
              let deltaX = e.touches[0].clientX - touchStartX;
              let deltaY = e.touches[0].clientY - touchStartY;

              // T·∫†I ƒê√ÇY: K·∫øt n·ªëi deltaX/deltaY v·ªõi h·ªá th·ªëng xoay camera c·ªßa b·∫°n
              // V√≠ d·ª•: camera.rotation.y -= deltaX * 0.005;

              touchStartX = e.touches[0].clientX;
              touchStartY = e.touches[0].clientY;
            }
          },
          { passive: false },
        );
      }

      // --- K·∫æT TH√öC: LOGIC N√öT THO√ÅT V√Ä MOBILE ---
      // ... existing code ...
    </script>
  </body>
</html>
